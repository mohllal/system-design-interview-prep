# Back of the Envelope Calculations

Back-of-the-envelope calculations are quick estimations help demonstrate the ability to think at scale and make trade-offs when designing systems.

The idea is to use simplifications and basic math to approximate system requirements such as traffic, storage, cache, bandwidth, and throughput without requiring full precision.

## Common metrics

- Load Estimation
- Storage Estimation
- Network Bandwidth Estimation
- Latency Estimation
- Number of Servers Estimation

## Common Unites

| Unit | Equivalent |
| :--: | :--------: |
| 1 KB | 1000 bytes |
| 1 MB |  1000 KB   |
| 1 GB |  1000 MB   |
| 1 TB |  1000 GB   |
| 1 PB |  1000 TB   |

The difference between 1 MB (Megabyte) and 1 MiB (Mebibyte) comes down to the way they define "kilo" in the context of bytes. The decimal (SI) system uses powers of 10, while the binary (IEC) system uses powers of 2.

| Unit  | Equivalent |
| :---: | :--------: |
| 1 KiB | 1024 bytes |
| 1 MiB |  1024 KiB  |
| 1 GiB |  1024 MiB  |
| 1 TiB |  1024 GiB  |
| 1 PiB |  1024 TiB  |

## Estimation templates

### Load Estimation

Estimate the expected number of requests per second, data volume, or user traffic for the system. It should factor in whether the application is read-heavy, write-heavy, or balanced.

It could be measured by Queries Per Second (QPS) or Requests per Second (RPS).

**RPS formula**:

$$
\text{RPS} = \frac{\text{Daily Active Users (DAU)} \times \text{Average Requests per User per Day}}{\text{Number of Seconds per Day (86400)}}
$$

**Read QPS formula**:

$$
\text{Read QPS} = \frac{\text{Daily Active Users (DAU)} \times \text{Average Reads per User per Day}}{\text{Number of Seconds per Day (86400)}}
$$

**Write QPS formula**:

$$
\text{Write QPS} = \frac{\text{Daily Active Users (DAU)} \times \text{Average Writes per User per Day}}{\text{Number of Seconds per Day (86400)}}
$$

**Peak QPS/RPS**: Multiply each by 2 to account for peak traffic.

#### Example

For a system with 200 million monthly active users, assume 50% of users are active daily.

To calculate Daily Active Users (DAU):

$$
\text{Daily Active Users (DAU)} = 200\ \text{Million} \times 50\% = 100\ \text{Million}
$$

Assuming it is a read heavy application:

- Total DAU: 100 million users
- Average Requests per User per Day: 15
- Average Reads per User per Day: 20
- Average Writes per User per Day: 1

Then to calculate Requests per Second (RPS) based on the previous information:

$$
\text{Requests Per Second (RPS)} = \frac{100\ \text{Million} \times 15\ \text{Requests per User per Day}}{\text{Number of Seconds per Day (86400)}} ≈ 17000\ \text{Requests/Second}
$$

Then to calculate Read Queries per Second (QPS) based on the previous information:

$$
\text{Read QPS} = \frac{100\ \text{Million} \times 20\ \text{Reads per User per Day}}{\text{Number of Seconds per Day (86400)}} ≈ 23000\ \text{Reads/Second}
$$

And the Write Queries per Second (QPS) based on the previous:

$$
\text{Write QPS} = \frac{100\ \text{Million} \times 1\ \text{Writes per User per Day}}{\text{Number of Seconds per Day (86400)}} ≈ 1200\ \text{Writes/Second}
$$

Peak QPS: Multiply by 2 to account for peak traffic.

$$
\text{Peak Read QPS} = 2 \times \text{Read QPS} = 2 \times 23000 = 46000\ \text{Reads/Second}
$$

$$
\text{Peak Write QPS} = 2 \times \text{Write QPS} = 2 \times 1200 = 2400\ \text{Writes/Second}
$$

$$
\text{Peak RPS} = 2 \times \text{RPS} = 2 \times 17000 = 34000\ \text{Requests/Second}
$$

### Storage Estimation

Estimate the amount of storage required to handle the data generated by the system.

Formula:

$$
\text{Storage} = \text{DAU} \times \text{Number of Objects per User per Day} \times \text{Average Object Size}
$$

Common storage estimations:

|             Type             | Size (approx) |
| :--------------------------: | :-----------: |
|      1 ASCII character       |    1 byte     |
|      1 UTF-16 character      |    2 bytes    |
|     1 image (compressed)     | 500 KB – 1 MB |
|   1 high-resolution image    |   2 – 5 MB    |
|    1-minute video (1080p)    |    100 MB     |
|  1-minute audio (128 Kbps)   |     1 MB      |
|      User profile data       |     1 KB      |
|    Tweet text (140 chars)    |   140 bytes   |
|             UUID             |   16 bytes    |
|           Integer            |    4 bytes    |
|            Float             |    4 bytes    |
|          Date/Time           |    8 bytes    |
|          Log entry           |   200 bytes   |
| HTML webpage (without media) |   2 – 5 KB    |

#### Example

Estimating media storage for a system like Twitter:

- Assume 150 million daily active users (DAU).
- Average of 2 tweets per user per day.
- 10% of tweets contain media, and each media file is 1 MB.

Daily media-based tweets storage:

$$
150\ \text{Million} \times 10\%\ \text{Writes} \times 2\ \text{Tweets per User} \times 1\ \text{MB per Tweet} = 30\ \text{TB/Day}
$$

One text-based tweet needs:

$$
120\ \text{Character} \times 2\ \text{Bytes per Character} = 240\ \text{Bytes/tweet}
$$

Daily text-based tweets storage:

$$
150\ \text{Million} \times 2\ \text{Tweets per User} \times 240\ \text{Bytes per Tweet} = 72 \text{GB/Day}
$$

So five-year storage, assuming a retention policy where no data older than five years is stored:

$$
30\ \text{TB/Day for Media-Based Tweets} + 72\ \text{GB/Day for Text-Based Tweets} \times 365\ \text{Days} \times 5\ \text{Years} ≈ 55 \text{PB}
$$

### Network Bandwidth Estimation

Estimate the network bandwidth needed to support the expected traffic and data transfer.

Formula:

$$
\text{Bandwidth} = \text{Number of Requests per Second} \times \text{Size of Response Data}
$$

#### Example

If each request returns 500 KB of data and RPS is 17000, bandwidth is calculated as

$$
17000\ \text{RPS} \times 500\ \text{KB} ≈ 9\ \text{GB/second}
$$

### Latency Estimation

Latency is the time taken for a request to travel through the system and return a response.

Estimating latency helps determine how responsive a system will be under load.

Common latency estimations:

**Network Latency**:

|    Component     |  Latency Range  |
| :--------------: | :-------------: |
| Same data center |  ~100 ns (0.1 ms) – 500 ns (0.5 ms) |
|   Cross-region   | 50 ms – 100 ms  |
| Cross-continent  | 150 ms – 300 ms |

**Disk Latency**:

| Component | Latency Range |
| :-------: | :-----------: |
|    SSD    | 100 µs – 1 ms |
|    HDD    | 2 ms – 20 ms  |

**Memory Access Latency**:

| Component |           Latency Range            |
| :-------: | :--------------------------------: |
|    RAM    | ~100 ns (0.1 ms) – 200 ns (0.2 ms) |

Formula:

$$
\text{Total Latency} = \text{Network Latency} + \text{Disk/Memory Access} + \text{Database Latency} + \text{Application Processing}
$$

#### Example

For a request with cross-region latency (~100 ms), a cache hit (~0.1 ms), and simple processing (~5 ms):

$$
\text{Total Latency} ≈ 105\ \text{ms}
$$

### Number of Servers Estimation

Formula:

$$
\text{Number of Servers} = \frac{\text{Total Load}}{\text{Capacity of One Server}}
$$

#### Example

If each server can handle 500 RPS and the Peak RPS is 34000, then the number of servers needed is:

$$
\frac{34000\ \text{RPS}}{500\ \text{RPS/server}} ≈ 70\ \text{servers}
$$

## External references

- [Latency Numbers Every Programmer Should Know](https://colin-scott.github.io/personal_website/research/interactive_latency.html)
- [Back-of-the-Envelope Calculation in System Design Interviews: A Comprehensive Guide](https://www.designgurus.io/blog/back-of-the-envelope-system-design-interview)
- [Back-of-the-envelope Estimation](https://bytebytego.com/courses/system-design-interview/back-of-the-envelope-estimation)
- [Back of the Envelope: Capacity Planning System Design](https://systemdesign.one/back-of-the-envelope/)